# План выполнения проекта GophKeeper

## Фаза 1: Инициализация проекта и базовая инфраструктура

### 1.1 Настройка проекта
- [ ] Инициализация Go модуля (`go mod init`)
- [ ] Создание базовой структуры директорий
- [ ] Настройка `.gitignore` для Go проектов
- [ ] Настройка CI/CD (GitHub Actions или аналог)
- [ ] Настройка golangci-lint конфигурации

### 1.2 Базовая структура кода
- [ ] Создание `cmd/server/main.go`
- [ ] Создание `cmd/client/main.go`
- [ ] Настройка версионирования (buildVersion, buildDate)
- [ ] Реализация флага `--version` для клиента

## Фаза 2: Криптография и безопасность

### 2.1 Криптографические утилиты (`internal/crypto/`)
- [ ] Реализация шифрования AES-256-GCM
- [ ] Реализация дешифрования
- [ ] Реализация key derivation (Argon2 или PBKDF2)
- [ ] Генерация случайных salt/nonce
- [ ] Хеширование паролей для аутентификации
- [ ] Тесты для всех криптографических функций (>80% coverage)

### 2.2 TLS конфигурация
- [ ] Генерация самоподписанных сертификатов для разработки
- [ ] Настройка TLS для сервера
- [ ] Настройка TLS для клиента

## Фаза 3: Хранилище данных

### 3.1 Серверное хранилище (`internal/storage/server/`)
- [ ] Выбор БД (PostgreSQL/SQLite)
- [ ] Разработка схемы БД для хранения пользователей
- [ ] Разработка схемы БД для хранения зашифрованных данных
- [ ] Разработка схемы БД для метаданных
- [ ] Реализация миграций
- [ ] Реализация CRUD операций для пользователей
- [ ] Реализация CRUD операций для данных
- [ ] Тесты для storage layer

### 3.2 Клиентское хранилище (`internal/storage/client/`)
- [ ] Интеграция BoltDB
- [ ] Разработка схемы buckets для BoltDB
- [ ] Реализация CRUD операций в BoltDB
- [ ] Реализация локального кеша данных
- [ ] Тесты для BoltDB storage

## Фаза 4: CRDT для синхронизации

### 4.1 Реализация CRDT (`internal/crdt/`)
- [ ] Выбор типа CRDT (LWW-Element-Set, OR-Set, или другой)
- [ ] Реализация базовой CRDT структуры данных
- [ ] Реализация операций: add, update, delete с timestamps
- [ ] Реализация merge логики для разрешения конфликтов
- [ ] Реализация vector clocks или Lamport timestamps
- [ ] Тесты для CRDT логики (включая конфликтные сценарии)

### 4.2 Синхронизация данных
- [ ] Разработка протокола синхронизации
- [ ] Реализация delta-sync для оптимизации трафика
- [ ] Реализация conflict resolution на сервере
- [ ] Тесты для синхронизации между клиентами

## Фаза 5: API и протокол взаимодействия

### 5.1 Определение API (`api/`)
- [ ] Выбор протокола (gRPC/HTTP REST)
- [ ] Разработка proto-файлов (если gRPC) или OpenAPI spec
- [ ] Генерация кода из proto/OpenAPI
- [ ] Документация API

### 5.2 Эндпоинты API
- [ ] POST /api/register - регистрация пользователя
- [ ] POST /api/login - аутентификация
- [ ] GET /api/sync - получение изменений с сервера
- [ ] POST /api/sync - отправка изменений на сервер
- [ ] GET /api/data - получение всех данных
- [ ] POST /api/data - создание новых данных
- [ ] PUT /api/data/:id - обновление данных
- [ ] DELETE /api/data/:id - удаление данных

## Фаза 6: Аутентификация и авторизация

### 6.1 Серверная аутентификация (`internal/server/auth/`)
- [ ] Реализация регистрации пользователей
- [ ] Реализация аутентификации (login)
- [ ] Генерация JWT или session tokens
- [ ] Middleware для проверки токенов
- [ ] Реализация refresh tokens
- [ ] Тесты для auth логики

### 6.2 Клиентская аутентификация (`internal/client/auth/`)
- [ ] Реализация CLI команд для регистрации
- [ ] Реализация CLI команд для login
- [ ] Хранение токенов на клиенте (безопасное хранилище)
- [ ] Автоматическое обновление токенов

## Фаза 7: Модели данных

### 7.1 Типы данных (`internal/models/`)
- [ ] Модель для логин/пароль пар
- [ ] Модель для текстовых данных
- [ ] Модель для бинарных данных
- [ ] Модель для данных банковских карт
- [ ] Модель для метаданных
- [ ] Валидация всех моделей
- [ ] Сериализация/десериализация
- [ ] Тесты для моделей

### 7.2 Шифрование данных
- [ ] Шифрование перед сохранением на клиенте
- [ ] Шифрование перед отправкой на сервер
- [ ] Дешифрование при получении с сервера
- [ ] Дешифрование при чтении из локального хранилища

## Фаза 8: Серверная реализация

### 8.1 HTTP/gRPC сервер (`internal/server/`)
- [ ] Настройка HTTP/gRPC сервера
- [ ] Роутинг и handlers
- [ ] Middleware (auth, logging, recovery)
- [ ] Graceful shutdown
- [ ] Конфигурация через environment variables/config file
- [ ] Логирование (без sensitive данных)

### 8.2 Бизнес-логика сервера
- [ ] Обработка регистрации
- [ ] Обработка аутентификации
- [ ] Обработка синхронизации данных
- [ ] Обработка CRUD операций
- [ ] Валидация входящих данных
- [ ] Обработка ошибок

## Фаза 9: Клиентская реализация

### 9.1 CLI интерфейс (`cmd/client/`, `internal/client/cli/`)
- [ ] Использование cobra/cli библиотеки
- [ ] Команда: register
- [ ] Команда: login
- [ ] Команда: logout
- [ ] Команда: add (добавление данных разных типов)
- [ ] Команда: list (просмотр данных)
- [ ] Команда: get (получение конкретной записи)
- [ ] Команда: update (редактирование)
- [ ] Команда: delete (удаление)
- [ ] Команда: sync (принудительная синхронизация)
- [ ] Команда: --version

### 9.2 Клиентская бизнес-логика (`internal/client/`)
- [ ] Менеджер аутентификации
- [ ] Менеджер локального хранилища
- [ ] HTTP/gRPC клиент для взаимодействия с сервером
- [ ] Логика синхронизации (push/pull)
- [ ] Обработка offline режима
- [ ] Валидация пользовательского ввода
- [ ] Обработка ошибок и user-friendly сообщения

## Фаза 10: Тестирование

### 10.1 Unit тесты
- [ ] Тесты для всех пакетов в `internal/`
- [ ] Тесты для всех пакетов в `pkg/`
- [ ] Достижение минимум 80% coverage
- [ ] Генерация coverage отчета

### 10.2 Интеграционные тесты
- [ ] Тесты для API эндпоинтов
- [ ] Тесты для взаимодействия клиент-сервер
- [ ] Тесты для синхронизации между несколькими клиентами
- [ ] Тесты для конфликтных сценариев (CRDT)

### 10.3 E2E тесты
- [ ] Сценарий: новый пользователь регистрируется
- [ ] Сценарий: пользователь добавляет данные и синхронизирует
- [ ] Сценарий: несколько клиентов одного пользователя синхронизируются
- [ ] Сценарий: offline -> online синхронизация

## Фаза 11: Документация

### 11.1 Код документация
- [ ] Godoc комментарии для всех exported функций
- [ ] Godoc комментарии для всех exported типов
- [ ] Godoc комментарии для всех exported переменных
- [ ] Godoc комментарии на уровне пакетов

### 11.2 Пользовательская документация
- [ ] Обновление README.md с инструкциями по сборке
- [ ] Обновление README.md с инструкциями по запуску
- [ ] Примеры использования CLI команд
- [ ] Документация по API (если требуется)

## Фаза 12: Опциональные функции (по выбору)

### 12.1 OTP (One Time Password)
- [ ] Модель данных для OTP
- [ ] Генерация TOTP кодов
- [ ] CLI команды для работы с OTP
- [ ] Тесты

### 12.2 TUI (Terminal User Interface)
- [ ] Интеграция библиотеки (bubbletea/tview)
- [ ] Интерактивный интерфейс для просмотра данных
- [ ] Интерактивный интерфейс для редактирования
- [ ] Navigation и hot keys

### 12.3 Binary протокол (gRPC)
- [ ] Proto файлы для всех сервисов
- [ ] Генерация gRPC кода
- [ ] Реализация gRPC сервера
- [ ] Реализация gRPC клиента

### 12.4 Swagger документация
- [ ] OpenAPI спецификация
- [ ] Swagger UI интеграция
- [ ] Автогенерация из кода (swaggo или аналог)

## Фаза 13: Деплой и дистрибуция

### 13.1 Сборка бинарников
- [ ] Makefile для автоматизации сборки
- [ ] Cross-compilation для Windows, Linux, macOS
- [ ] Интеграция build version и build date
- [ ] Docker образы для сервера

### 13.2 CI/CD
- [ ] Автоматические тесты при push
- [ ] Автоматическая сборка релизов
- [ ] Автоматическая публикация артефактов
- [ ] Linting в CI

## Фаза 14: Финальная проверка

### 14.1 Проверка требований
- [ ] Все обязательные функции реализованы
- [ ] Coverage >= 80%
- [ ] Вся документация на месте
- [ ] CLI работает на Windows, Linux, macOS
- [ ] --version показывает версию и дату

### 14.2 Code review и рефакторинг
- [ ] Проверка на code smells
- [ ] Оптимизация производительности
- [ ] Проверка безопасности
- [ ] Финальный рефакторинг

## Оценка времени (примерная)

- Фаза 1-2: 3-5 дней
- Фаза 3-4: 7-10 дней (CRDT - сложная часть)
- Фаза 5-6: 5-7 дней
- Фаза 7-8: 5-7 дней
- Фаза 9: 5-7 дней
- Фаза 10: 7-10 дней (80% coverage)
- Фаза 11: 2-3 дня
- Фаза 12: 5-10 дней (опционально)
- Фаза 13-14: 3-5 дней

**Итого: 42-64 дня (6-9 недель) без опциональных функций**

## Приоритизация

### Must Have (MVP)
1. Базовая криптография
2. Аутентификация и авторизация
3. Хранилище (сервер + BoltDB)
4. Базовая CRDT синхронизация
5. CLI для основных операций
6. Типы данных: логин/пароль, текст
7. Минимум 80% тестов

### Should Have
1. Все 5 типов данных
2. Полная CRDT с conflict resolution
3. TLS
4. Метаданные
5. Интеграционные тесты

### Nice to Have
1. OTP
2. TUI
3. gRPC
4. Swagger
5. Docker
